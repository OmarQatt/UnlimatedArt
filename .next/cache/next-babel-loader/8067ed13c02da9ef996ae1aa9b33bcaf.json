{"ast":null,"code":"import connectDB from '../../../utils/connectDB';\nimport Products from '../../../models/productModel';\nimport auth from '../../../middleware/auth';\nconnectDB();\nexport default (async (req, res) => {\n  switch (req.method) {\n    case \"GET\":\n      await getProduct(req, res);\n      break;\n\n    case \"PUT\":\n      await updateProduct(req, res);\n      break;\n\n    case \"DELETE\":\n      await deleteProduct(req, res);\n      break;\n  }\n});\n\nconst getProduct = async (req, res) => {\n  try {\n    const {\n      id\n    } = req.query;\n    const product = await Products.findById(id);\n    if (!product) return res.status(400).json({\n      err: 'This product does not exist.'\n    });\n    res.json({\n      product\n    });\n  } catch (err) {\n    return res.status(500).json({\n      err: err.message\n    });\n  }\n};\n\nconst updateProduct = async (req, res) => {\n  try {\n    const result = await auth(req, res);\n    if (result.role !== 'admin') return res.status(400).json({\n      err: 'Authentication is not valid.'\n    });\n    const {\n      id\n    } = req.query;\n    const {\n      title,\n      price,\n      inStock,\n      description,\n      content,\n      category,\n      images\n    } = req.body;\n    if (!title || !price || !inStock || !description || !content || category === 'all' || images.length === 0) return res.status(400).json({\n      err: 'Please add all the fields.'\n    });\n    await Products.findOneAndUpdate({\n      _id: id\n    }, {\n      title: title.toLowerCase(),\n      price,\n      inStock,\n      description,\n      content,\n      category,\n      images\n    });\n    res.json({\n      msg: 'Success! Updated a product'\n    });\n  } catch (err) {\n    return res.status(500).json({\n      err: err.message\n    });\n  }\n};\n\nconst deleteProduct = async (req, res) => {\n  try {\n    const result = await auth(req, res);\n    if (result.role !== 'admin') return res.status(400).json({\n      err: 'Authentication is not valid.'\n    });\n    const {\n      id\n    } = req.query;\n    await Products.findByIdAndDelete(id);\n    res.json({\n      msg: 'Deleted a product.'\n    });\n  } catch (err) {\n    return res.status(500).json({\n      err: err.message\n    });\n  }\n};","map":{"version":3,"names":["connectDB","Products","auth","req","res","method","getProduct","updateProduct","deleteProduct","id","query","product","findById","status","json","err","message","result","role","title","price","inStock","description","content","category","images","body","length","findOneAndUpdate","_id","toLowerCase","msg","findByIdAndDelete"],"sources":["C:/Users/DELL/Desktop/nextjs-ecommerce-master/pages/api/product/[id].js"],"sourcesContent":["import connectDB from '../../../utils/connectDB'\nimport Products from '../../../models/productModel'\nimport auth from '../../../middleware/auth'\n\nconnectDB()\n\nexport default async (req, res) => {\n    switch(req.method){\n        case \"GET\":\n            await getProduct(req, res)\n            break;\n        case \"PUT\":\n            await updateProduct(req, res)\n            break;\n        case \"DELETE\":\n            await deleteProduct(req, res)\n            break;\n    }\n}\n\nconst getProduct = async (req, res) => {\n    try {\n        const { id } = req.query;\n\n        const product = await Products.findById(id)\n        if(!product) return res.status(400).json({err: 'This product does not exist.'})\n        \n        res.json({ product })\n\n    } catch (err) {\n        return res.status(500).json({err: err.message})\n    }\n}\n\nconst updateProduct = async (req, res) => {\n    try {\n        const result = await auth(req, res)\n        if(result.role !== 'admin') \n        return res.status(400).json({err: 'Authentication is not valid.'})\n\n        const {id} = req.query\n        const {title, price, inStock, description, content, category, images} = req.body\n\n        if(!title || !price || !inStock || !description || !content || category === 'all' || images.length === 0)\n        return res.status(400).json({err: 'Please add all the fields.'})\n\n        await Products.findOneAndUpdate({_id: id}, {\n            title: title.toLowerCase(), price, inStock, description, content, category, images\n        })\n\n        res.json({msg: 'Success! Updated a product'})\n    } catch (err) {\n        return res.status(500).json({err: err.message})\n    }\n}\n\nconst deleteProduct = async(req, res) => {\n    try {\n        const result = await auth(req, res)\n        \n        if(result.role !== 'admin') \n        return res.status(400).json({err: 'Authentication is not valid.'})\n\n        const {id} = req.query\n\n        await Products.findByIdAndDelete(id)\n        res.json({msg: 'Deleted a product.'})\n\n    } catch (err) {\n        return res.status(500).json({err: err.message})\n    }\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}