{"ast":null,"code":"import connectDB from '../../../utils/connectDB';\nimport Users from '../../../models/userModel';\nimport auth from '../../../middleware/auth';\nconnectDB();\nexport default (async (req, res) => {\n  switch (req.method) {\n    case \"PATCH\":\n      await updateRole(req, res);\n      break;\n\n    case \"DELETE\":\n      await deleteUser(req, res);\n      break;\n  }\n});\n\nconst updateRole = async (req, res) => {\n  try {\n    const result = await auth(req, res);\n    if (result.role !== 'admin' || !result.root) return res.status(400).json({\n      err: \"Authentication is not valid\"\n    });\n    const {\n      id\n    } = req.query;\n    const {\n      role\n    } = req.body;\n    await Users.findOneAndUpdate({\n      _id: id\n    }, {\n      role\n    });\n    res.json({\n      msg: 'Update Success!'\n    });\n  } catch (err) {\n    return res.status(500).json({\n      err: err.message\n    });\n  }\n};\n\nconst deleteUser = async (req, res) => {\n  try {\n    const result = await auth(req, res);\n    if (result.role !== 'admin' || !result.root) return res.status(400).json({\n      err: \"Authentication is not valid\"\n    });\n    const {\n      id\n    } = req.query;\n    await Users.findByIdAndDelete(id);\n    res.json({\n      msg: 'Deleted Success!'\n    });\n  } catch (err) {\n    return res.status(500).json({\n      err: err.message\n    });\n  }\n};","map":{"version":3,"names":["connectDB","Users","auth","req","res","method","updateRole","deleteUser","result","role","root","status","json","err","id","query","body","findOneAndUpdate","_id","msg","message","findByIdAndDelete"],"sources":["C:/Users/DELL/Desktop/nextjs-ecommerce-master/pages/api/user/[id].js"],"sourcesContent":["import connectDB from '../../../utils/connectDB'\nimport Users from '../../../models/userModel'\nimport auth from '../../../middleware/auth'\n\nconnectDB()\n\nexport default async (req, res) => {\n    switch(req.method){\n        case \"PATCH\":\n            await updateRole(req, res)\n            break;\n        case \"DELETE\":\n            await deleteUser(req, res)\n            break;\n    }\n}\n\nconst updateRole = async (req, res) => {\n    try {\n       const result = await auth(req, res)\n       if(result.role !== 'admin' || !result.root) \n       return res.status(400).json({err: \"Authentication is not valid\"})\n\n       const {id} = req.query\n       const {role} = req.body\n\n       await Users.findOneAndUpdate({_id: id}, {role})\n       res.json({msg: 'Update Success!'})\n\n    } catch (err) {\n        return res.status(500).json({err: err.message})\n    }\n}\n\nconst deleteUser = async (req, res) => {\n    try {\n       const result = await auth(req, res)\n       if(result.role !== 'admin' || !result.root) \n       return res.status(400).json({err: \"Authentication is not valid\"})\n\n       const {id} = req.query\n\n       await Users.findByIdAndDelete(id)\n       res.json({msg: 'Deleted Success!'})\n\n    } catch (err) {\n        return res.status(500).json({err: err.message})\n    }\n}"],"mappings":"AAAA,OAAOA,SAAP,MAAsB,0BAAtB;AACA,OAAOC,KAAP,MAAkB,2BAAlB;AACA,OAAOC,IAAP,MAAiB,0BAAjB;AAEAF,SAAS;AAET,gBAAe,OAAOG,GAAP,EAAYC,GAAZ,KAAoB;EAC/B,QAAOD,GAAG,CAACE,MAAX;IACI,KAAK,OAAL;MACI,MAAMC,UAAU,CAACH,GAAD,EAAMC,GAAN,CAAhB;MACA;;IACJ,KAAK,QAAL;MACI,MAAMG,UAAU,CAACJ,GAAD,EAAMC,GAAN,CAAhB;MACA;EANR;AAQH,CATD;;AAWA,MAAME,UAAU,GAAG,OAAOH,GAAP,EAAYC,GAAZ,KAAoB;EACnC,IAAI;IACD,MAAMI,MAAM,GAAG,MAAMN,IAAI,CAACC,GAAD,EAAMC,GAAN,CAAzB;IACA,IAAGI,MAAM,CAACC,IAAP,KAAgB,OAAhB,IAA2B,CAACD,MAAM,CAACE,IAAtC,EACA,OAAON,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;MAACC,GAAG,EAAE;IAAN,CAArB,CAAP;IAEA,MAAM;MAACC;IAAD,IAAOX,GAAG,CAACY,KAAjB;IACA,MAAM;MAACN;IAAD,IAASN,GAAG,CAACa,IAAnB;IAEA,MAAMf,KAAK,CAACgB,gBAAN,CAAuB;MAACC,GAAG,EAAEJ;IAAN,CAAvB,EAAkC;MAACL;IAAD,CAAlC,CAAN;IACAL,GAAG,CAACQ,IAAJ,CAAS;MAACO,GAAG,EAAE;IAAN,CAAT;EAEF,CAXD,CAWE,OAAON,GAAP,EAAY;IACV,OAAOT,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;MAACC,GAAG,EAAEA,GAAG,CAACO;IAAV,CAArB,CAAP;EACH;AACJ,CAfD;;AAiBA,MAAMb,UAAU,GAAG,OAAOJ,GAAP,EAAYC,GAAZ,KAAoB;EACnC,IAAI;IACD,MAAMI,MAAM,GAAG,MAAMN,IAAI,CAACC,GAAD,EAAMC,GAAN,CAAzB;IACA,IAAGI,MAAM,CAACC,IAAP,KAAgB,OAAhB,IAA2B,CAACD,MAAM,CAACE,IAAtC,EACA,OAAON,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;MAACC,GAAG,EAAE;IAAN,CAArB,CAAP;IAEA,MAAM;MAACC;IAAD,IAAOX,GAAG,CAACY,KAAjB;IAEA,MAAMd,KAAK,CAACoB,iBAAN,CAAwBP,EAAxB,CAAN;IACAV,GAAG,CAACQ,IAAJ,CAAS;MAACO,GAAG,EAAE;IAAN,CAAT;EAEF,CAVD,CAUE,OAAON,GAAP,EAAY;IACV,OAAOT,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;MAACC,GAAG,EAAEA,GAAG,CAACO;IAAV,CAArB,CAAP;EACH;AACJ,CAdD"},"metadata":{},"sourceType":"module"}